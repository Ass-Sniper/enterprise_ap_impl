FROM freeradius/freeradius-server:latest-3.2-alpine

# ------------------------------------------------------------
# Alpine å›½å†…æº
# ------------------------------------------------------------
RUN sed -i 's|https://dl-cdn.alpinelinux.org|https://mirrors.tuna.tsinghua.edu.cn|g' \
    /etc/apk/repositories

# ------------------------------------------------------------
# SQL runtime dependencyï¼ˆMySQL / MariaDBï¼‰
# ------------------------------------------------------------
RUN apk add --no-cache mariadb-connector-c

# ------------------------------------------------------------
# overlayï¼šæœ€å°ã€ç¡®å®šã€æ— éšå¼ include
# ------------------------------------------------------------

# clients
COPY freeradius/raddb/clients.conf \
     /opt/etc/raddb/clients.conf

# SQL æ¨¡å—ï¼ˆå·²éªŒè¯å¯ç”¨ï¼‰
COPY freeradius/raddb/mods-enabled/sql \
     /opt/etc/raddb/mods-enabled/sql

# ğŸ‘‰ ä½¿ç”¨ä½ è‡ªå·±çš„ serverï¼ˆä¾‹å¦‚ portalï¼‰
COPY freeradius/raddb/sites-enabled/portal \
     /opt/etc/raddb/sites-enabled/portal

# ------------------------------------------------------------
# è£å‰ªæ— å…³æ¨¡å—
# ------------------------------------------------------------
RUN rm -f /opt/etc/raddb/mods-enabled/eap \
 && rm -f /opt/etc/raddb/sites-enabled/inner-tunnel \
 && rm -f /opt/etc/raddb/sites-enabled/default

# ------------------------------------------------------------
# æƒé™ä¿®æ­£
# ------------------------------------------------------------
RUN find /opt/etc/raddb -type f -exec chmod 644 {} \; \
 && find /opt/etc/raddb -type d -exec chmod 755 {} \;
